<html>
<head>
    <meta http-equiv=Content-Type content="text/html;charset=utf-8">
    <title></title>
    <link rel="stylesheet" type="text/css"
          href="/static/css/date/bootstrap-datetimepicker.min.css"/>

    <link rel="stylesheet" type="text/css" href="/static/css/date/bootstrap.min.css"/>

    <script src="/static/js/jquery.min.js" type="text/javascript"></script>

    <script type="text/javascript" src="/static/js/date/bootstrap-datetimepicker.min.js"></script>

    <script type="text/javascript">

        $(document).ready(function () {

            $(".item").click(function () {

                $(".item").each(function (i) {

                    $(this).removeClass("defineItem");

                });

                $(this).addClass("defineItem");

                $(".tabContent").each(function (i) {

                    $(this).css("display", "none");
                });

                var idName = $(this).attr("name");

                $("#" + idName).css("display", "block");

            });


            //消费人
            $("#consumer").change(function(){

                var consumer = $(this).val();

                if(consumer=="" || isNaN(consumer)){

                    $("#consumerMesg").html("请选择消费人！");
                }else{

                    $("#consumerMesg").html("");
                }

            });


            $(".typeSelect").live("change", function () {

                $(this).nextAll(".typeSelect").remove();

                var selectOptionVal = $(this).val();

                var idName = $(this).parents(".tabContent").attr("id");

                if (!isNaN(selectOptionVal)) {

                    $("#"+idName+"TypeMesg").html("");

                    var subClassName = $(this).attr("name");

                    $.post("/admin/consume/getConsumeTypeByPid", {"pid": selectOptionVal}, function (data) {

                        if(data.length>0){

                        var select = '<select class="input typeSelect '+subClassName+'" name="'+subClassName+'">';

                        for (var i = 0; i < data.length; i++) {
                            select += '<option value="' + data[i].consumeTypeId + '">' + data[i].consumeTypeName + '</option>';
                        }
                        select += '</select>';

                        $("#"+idName+"TypeArea").append(select);
                        }
                    })
                }else{

                    $("#"+idName+"TypeMesg").html("请选择消费类别！");
                }

            });


            //默认当前时间
            $(".form_datetime").each(function(){

                $(this).val(getNowFormatDate())
            });

            function getNowFormatDate() {
                var date = new Date();
                var seperator1 = "-";
                var seperator2 = ":";
                var month = date.getMonth() + 1;
                var strDate = date.getDate();
                if (month >= 1 && month <= 9) {
                    month = "0" + month;
                }
                if (strDate >= 0 && strDate <= 9) {
                    strDate = "0" + strDate;
                }
                var currentdate = date.getFullYear() + seperator1 + month + seperator1 + strDate
                        + " " + date.getHours() + seperator2 + date.getMinutes();
                return currentdate;
            }


            //提交操作
            $(".submit").mouseover(function(){

                $(this).css("font-size","16px");

            });

            $(".submit").mouseout(function(){

                $(this).css("font-size","14px");

            });


            $(".submit").click(function(){

                var idName = $(this).parent().attr("id");

                var amount = verifyAmount(idName);

                var type = 0;
                if(!amount){

                    return false;
                }else{

                    switch (idName){

                        case "pay":

                            amount = -amount;
                            break;

                        case "income":

                            type = 1;
                            break;
                    }
                }

                var consumerId = verifyPeople(idName);

                if(!consumerId){

                    return false;
                }

                var consumeTypeId = verifyType(idName);

                if(!consumeTypeId){

                    return false;
                }


                var dateTime = $("#"+idName+"DateTime").val();

                var todo=$("#"+idName+"Todo").val();

                alert(amount+"-"+consumeTypeId+"-"+consumerId+"-"+dateTime+"-"+todo+"-"+type);

                $.post("/admin/bill/add",{"amount":amount,"consumeTypeId":consumeTypeId,"consumerId":consumerId,"consumeDate":dateTime,"todo":todo,"type":type},function(data){

                    if(data==1){

                        alert("添加成功！");
                    }else{

                        alert("添加失败！");
                    }

                });


            });


            function verifyAmount(idName){

                var money = $("#"+idName+"Money").val();

                if(money == "" || isNaN(money)){

                    $("#"+idName+"MoneyMesg").html("请填写合法金额！");

                    return false;
                }else{

                    $("#"+idName+"MoneyMesg").html("");

                    return money;
                }
            }

            function verifyPeople(idName){

                var people = $("#"+idName+"People").val();

                if(people == "" || isNaN(people)){

                    $("#"+idName+"PeopleMesg").html("请选择消费人！");

                    return false;
                }else{

                    $("#"+idName+"PeopleMesg").html("");

                    return people;
                }
            }


            function verifyType(idName){

                var type = $("#"+idName+"Type").val();

                if(type == "" || isNaN(type)){

                    $("#"+idName+"TypeMesg").html("请选择消费类别！");

                    return false;
                }else{

                    $("#"+idName+"TypeMesg").html("");

                    type = $("."+idName+"TypeSelect:last").val();

                    return type;
                }

            }

        });


    </script>

    <style type="text/css">

        #container {
            margin-top: 52px;
            width: 100%;
            border-top: 1px solid grey;
        }

        .settingTitle {
            width: 100%;
            border-bottom: 1px solid grey;
        }

        .item {
            width: auto;
            padding: 5px;
            float: left;
            margin-left: 10px;
            border: 1px solid grey;
            cursor: pointer;
        }

        .defineItem {
            background: green;
            color: white;
        }

        .tabContent {
            margin-left: 100px;
            margin-top: 100px;
            width: 100%;
        }

        #billList {

            background: blue;
            height: 200px;
            display: none;
        }

        #income {
            display: none;
        }

        .list li {
            margin-top: 20px;
            list-style-type: none;
        }

        #payMoney,#incomeMoney{
            width: 180px;
            height: 30px;
            font-size: large;
            background: white;
            margin-left: 15px;
            border: 1px solid grey;
        }

        .input {
            width: 180px;
            height: 30px;
            font-size: large;
            background: white;
            margin-left: 10px;
            border: 1px solid grey;
        }

        .submit {
            color: white;
            width: 100px;
            cursor: pointer;
            height: 30px;
            background: green;
            text-align: center;
            line-height: 30px;
            margin-left: 120px;
        }

        .noticeMesg{
            color:red;
            font-size: 18px;
        }

        .field{
            font-size: 18px;
        }

        .todo {
            margin-left:15px;
            width:180px;
            border:1px solid grey;
        }
    </style>

</head>

<body>

<div id="container">

    <div class="settingTitle">
        <div class="item defineItem" name="pay">支 出</div>
        <div class="item" name="income">收 入</div>
        <div class="item" name="billList">账单列表</div>
    </div>


    <div id="pay" class="tabContent">

        <ul class="list">

            <li>
                <span class="field">消费金额：</span>
                <input type="text" value="" id="payMoney" />
                &nbsp;&nbsp;<span class="noticeMesg" id="payMoneyMesg"></span>
            </li>

            <li>
                <span class="field">消费所属：</span>
                &nbsp;<select class="input" id="payPeople">
                    <option value="">--请选择--</option>

                    #foreach($consumer in $consumerList)
                        <option value="${consumer.getConsumerId()}">${consumer.getConsumerName()}</option>
                    #end

                </select>
                &nbsp;&nbsp;<span class="noticeMesg" id="payPeopleMesg"></span>
            </li>

            <li id="payTypeArea">
                <span class="field">所属类型：</span>
                &nbsp;<select class="input typeSelect payTypeSelect" name="payTypeSelect" id="payType">
                    <option value="">--请选择--</option>

                    #foreach($consumeType in $consumeTypeList)
                        <option value="${consumeType.getConsumeTypeId()}">${consumeType.getConsumeTypeName()}</option>
                    #end

                </select>
                &nbsp;&nbsp;<span class="noticeMesg" id="payTypeMesg"></span>

            </li>

            <li>
                <span class="field">消费日期：</span>
                <input type="text" value="" class="form_datetime" id="payDateTime" readonly="readonly"
                       style="width: 180px; height: 30px; font-size: large; background: white; margin-left: 15px; border: 1px solid grey; cursor:pointer;">
            </li>

            <li>
                <span class="field">备注说明：</span>
                <textarea id="payTodo" class="todo"></textarea>
            </li>
        </ul>

        <div class="submit">添 加</div>

    </div>



    <div id="income" class="tabContent">

        <ul class="list">

            <li>
                <span class="field">收入金额：</span>
                <input type="text" value="" id="incomeMoney"/>
                &nbsp;&nbsp;<span class="noticeMesg" id="incomeMoneyMesg"></span>
            </li>


            <li>
                <span class="field">收入来源：</span>
                &nbsp;<select class="input" id="incomePeople">
                <option value="">--请选择--</option>

                #foreach($consumer in $consumerList)
                    <option value="${consumer.getConsumerId()}">${consumer.getConsumerName()}</option>
                #end

            </select>
                &nbsp;&nbsp;<span class="noticeMesg" id="imcomePeopleMesg"></span>
            </li>


            <li id="incomeTypeArea">
                <span class="field">收入类型：</span>
                &nbsp;<select class="input typeSelect incomeTypeSelect" name="incomeTypeSelect" id="incomeType">
                <option value="">--请选择--</option>

                #foreach($consumeType in $consumeTypeList)
                    <option value="${consumeType.getConsumeTypeId()}">${consumeType.getConsumeTypeName()}</option>
                #end

            </select>
                &nbsp;&nbsp;<span class="noticeMesg" id="incomeTypeMesg"></span>

            </li>


            <li>
                <span class="field">收入日期：</span>
                <input type="text" value="" class="form_datetime" id="incomeDateTime" readonly="readonly"
                       style="width: 180px; height: 30px; font-size: large; background: white; margin-left: 15px; border: 1px solid grey; cursor:pointer;">
            </li>

            <li>
                <span class="field">备注说明：</span>
                <textarea id="incomeTodo" class="todo"></textarea>
            </li>
        </ul>

        <div class="submit">添 加</div>

    </div>


    <div class="tabContent" id="billList">


    </div>


</div>


<script type="text/javascript">
    $(".form_datetime").datetimepicker({
        format: 'yyyy-mm-dd hh:ii',
        todayBtn: true,
        autoclose: true
    });
</script>


</body>

</html>